import subprocess
import os
from concurrent.futures import ThreadPoolExecutor

# List of dives with start and end times (HH:MM:SS format)
dive_times = [
    ("0:10:42", "0:10:49"),
    ("0:11:58", "0:12:03"),
    ("0:12:56", "0:13:00"),
    ("0:13:45", "0:13:49"),
    ("0:14:37", "0:14:42"),
    ("0:15:31", "0:15:36"),
    ("0:16:24", "0:16:29"),
    ("0:17:22", "0:17:25"),
    ("0:18:15", "0:18:20"),
    ("0:19:17", "0:19:23"),
    ("0:20:20", "0:20:28"),
    ("0:21:22", "0:21:26"),
    ("0:23:22", "0:23:28"),
    ("0:24:30", "0:24:37"),
    ("0:25:40", "0:25:44"),
    ("0:26:39", "0:26:43"),
    ("0:27:34", "0:27:38"),
    ("0:28:31", "0:28:34"),
    ("0:29:25", "0:29:30"),
    ("0:30:20", "0:30:26"),
    ("0:31:17", "0:31:22"),
    ("0:32:16", "0:32:19"),
    ("0:33:18", "0:33:24"),
    ("0:34:25", "0:34:30"),
    ("0:36:23", "0:36:28"),
    ("0:37:38", "0:37:44"),
    ("0:38:33", "0:38:38"),
    ("0:39:32", "0:39:38"),
    ("0:40:25", "0:40:29"),
    ("0:41:34", "0:41:41"),
    ("0:42:38", "0:42:41"),
    ("0:43:51", "0:43:58"),
    ("0:44:59", "0:45:05"),
    ("0:46:09", "0:46:18"),
    ("0:47:24", "0:47:30"),
    ("0:48:22", "0:48:26"),
    ("0:50:26", "0:50:30"),
    ("0:51:33", "0:51:41"),
    ("0:52:25", "0:52:29"),
    ("0:53:11", "0:53:16"),
    ("0:54:23", "0:54:28"),
    ("0:55:21", "0:55:25"),
    ("0:56:11", "0:56:16"),
    ("0:57:13", "0:57:20"),
    ("0:58:22", "0:58:27"),
    ("0:59:23", "0:59:30"),
    ("1:00:16", "1:00:22"),
    ("1:01:26", "1:01:34"),
    ("1:03:26", "1:03:33"),
    ("1:04:28", "1:04:32"),
    ("1:05:18", "1:05:21"),
    ("1:06:11", "1:06:15"),
    ("1:07:00", "1:07:08"),
    ("1:07:54", "1:07:58"),
    ("1:08:50", "1:08:56"),
    ("1:09:48", "1:09:52"),
    ("1:10:47", "1:10:51"),
    ("1:11:47", "1:11:53"),
    ("1:12:52", "1:12:56"),
    ("1:13:57", "1:14:03"),
    ("1:16:06", "1:16:10"),
    ("1:17:31", "1:17:35"),
    ("1:18:32", "1:18:38"),
    ("1:19:42", "1:19:50"),
    ("1:21:07", "1:21:11"),
    ("1:22:23", "1:22:27"),
    ("1:23:47", "1:23:51"),
    ("1:25:06", "1:25:17"),
    ("1:26:27", "1:26:33"),
    ("1:27:56", "1:28:04"),
    ("1:29:20", "1:29:25"),
    ("1:30:53", "1:30:57"),
]

# Input video path
input_video = "long_dive_video2.webm"

# Output folder path
output_folder = "Shortened videos/videos"
os.makedirs(output_folder, exist_ok=True)

# Function to process each clip better than old code
def process_clip(i, start, end):
    if i < 9:
        output_video = os.path.join(output_folder, f"2020_olympics_dive_0{i + 1}.mp4")
    else:
        output_video = os.path.join(output_folder, f"2020_olympics_dive_{i + 1}.mp4")
    
    cmd = [
        "ffmpeg", "-i", input_video, "-ss", start, "-to", end,
        "-c:v", "libx264", "-preset", "ultrafast", "-crf", "23",
        "-c:a", "aac", "-b:a", "128k",
        output_video
    ]
    subprocess.run(cmd)
    print(f"Created: {output_video}")

# Using ThreadPoolExecutor to parallelize the process
with ThreadPoolExecutor(max_workers=4) as executor:
    for i, (start, end) in enumerate(dive_times):
        executor.submit(process_clip, i, start, end)

